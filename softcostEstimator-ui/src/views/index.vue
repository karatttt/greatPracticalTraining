<!--<template>-->
<!--  <div class="app-container home">-->
<!--    <el-col :sm="30" :lg="24" class="app-content">-->
<!--    </el-col>-->
<!--    <el-divider />-->
<!--    <div align="center">-->
<!--      <img alt="Logo" src="https://i.ibb.co/RC5jjDh/GitHub.png" width="20%" />-->
<!--      <h1>è½¯ä»¶é€ ä»·é€š SoftcostEstimator</h1>-->
<!--    </div>-->

<!--    <p align="center">-->
<!--      <img alt="release" src="https://img.shields.io/badge/release-v0.0.1-brightgreen" />-->
<!--      <img alt="java" src="https://img.shields.io/badge/java-v23.0.1-brightgreen" />-->
<!--      <img alt="state" src="https://img.shields.io/badge/state-å­µåŒ–-brightgreen" />-->
<!--      <img alt="domain" src="https://img.shields.io/badge/domain-AI+è½¯ä»¶é€ ä»·è¯„ä¼°-brightgreen" />-->
<!--      <img alt="PRs welcome" src="https://img.shields.io/badge/PRs-welcome-brightgreen" />-->
<!--      <img alt="docs" src="https://img.shields.io/badge/docs-latest-blue" />-->
<!--      <img alt="code style" src="https://img.shields.io/badge/code%20style-black-000000" />-->
<!--    </p>-->

<!--    <section class="project-details">-->
<!--      <h3>ğŸ“˜ é¡¹ç›®ä»‹ç»</h3>-->
<!--      <p>-->
<!--        è¯¥é¡¹ç›®äº 11 æœˆ 12 æ—¥å¯åŠ¨ï¼Œæ—¨åœ¨æ„å»ºä¸€ä¸ªåŸºäºè‹¥ä¾åå°ç®¡ç†ç³»ç»Ÿçš„ AI+ è½¯ä»¶æˆæœ¬è¯„ä¼°ç³»ç»Ÿï¼šè½¯ä»¶é€ ä»·é€š SoftcostEstimatorï¼Œä¸“æ³¨äºç§Ÿæˆ·å’Œé¡¹ç›®ç®¡ç†ã€åŠŸèƒ½ç‚¹åˆ†æã€é€ ä»·ç»¼åˆè¯„ä¼°å’ŒæŠ¥å‘Šç”Ÿæˆä¸å±•ç¤ºå››ä¸ªå­ç³»ç»Ÿã€‚-->
<!--      </p>-->
<!--      <p>é¡¹ç›®åœ°å€ï¼š<a href="https://gitcode.com/zzq20226705/greatPracticalTraining.git" target="_blank">ä¼Ÿå¤§çš„å®è®­</a></p>-->
<!--      <p>é¡¹ç›®æ–‡æ¡£ï¼š<a href="https://gitcode.com/zzq20226705/greatPracticalTraining/overview" target="_blank">é¡¹ç›®æ–‡æ¡£</a></p>-->
<!--    </section>-->

<!--    <section class="main-features">-->
<!--      <h3>ğŸ”§ ä¸»è¦åŠŸèƒ½</h3>-->
<!--      <ol>-->
<!--        <li><b>ç§Ÿæˆ·å’Œé¡¹ç›®ç®¡ç†å­ç³»ç»Ÿï¼š</b> æ”¯æŒå¤šç§Ÿæˆ·ç¯å¢ƒï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§æ€§ï¼Œæå‡åä½œæ•ˆç‡ã€‚</li>-->
<!--        <li><b>åŠŸèƒ½ç‚¹åˆ†æå­ç³»ç»Ÿï¼š</b> è¯„ä¼°å¸ˆå¯ä»¥å½•å…¥å’Œç®¡ç†è½¯ä»¶é¡¹ç›®çš„åŠŸèƒ½ç»“æ„ï¼Œæä¾›åŸºç¡€æ•°æ®ã€‚</li>-->
<!--        <li><b>é€ ä»·ç»¼åˆè¯„ä¼°å­ç³»ç»Ÿï¼š</b> åŸºäºè¡Œä¸šåŸºå‡†æ•°æ®æˆ–å†å²é¡¹ç›®æ•°æ®ï¼Œæä¾›ç»¼åˆé€ ä»·è¯„ä¼°ã€‚</li>-->
<!--        <li><b>æŠ¥å‘Šç”Ÿæˆä¸å±•ç¤ºå­ç³»ç»Ÿï¼š</b> æ”¯æŒç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼Œå¹¶é€šè¿‡æ•°æ®å¯è§†åŒ–å±•ç¤ºè¿›åº¦å’Œè¯„ä¼°ç»“æœã€‚</li>-->
<!--      </ol>-->
<!--    </section>-->

<!--    <section class="tech-features">-->
<!--      <h3>ğŸ›  æŠ€æœ¯ç‰¹ç‚¹</h3>-->
<!--      <ul>-->
<!--        <li><b>å‰åç«¯åˆ†ç¦»ï¼š</b> æé«˜å¼€å‘æ•ˆç‡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li>-->
<!--        <li><b>AI+ï¼š</b> é›†æˆäººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œä¾¿äºæ‰©å±•ä¸ç»´æŠ¤ã€‚</li>-->
<!--        <li><b>æ•°æ®äº‘ç«¯å­˜å‚¨ï¼š</b> æå‡æ•°æ®å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</li>-->
<!--      </ul>-->
<!--    </section>-->

<!--    <section class="contributing">-->
<!--      <h3>ğŸ¤ è´¡çŒ®æŒ‡å—</h3>-->
<!--      <p>æ¬¢è¿è´¡çŒ®è€…æŒ‰ç…§ä»¥ä¸‹æ–¹å¼æäº¤è´¡çŒ®ã€‚</p>-->
<!--      <ol>-->
<!--        <li>Fork æœ¬ä»“åº“</li>-->
<!--        <li>åˆ›å»ºç‰¹æ€§åˆ†æ”¯</li>-->
<!--        <li>æäº¤æ›´æ”¹å¹¶æ¨é€åˆ°åˆ†æ”¯</li>-->
<!--        <li>æäº¤ Pull Request</li>-->
<!--      </ol>-->
<!--    </section>-->
<!--    <p>-->
<!--      <el-button-->
<!--        type="primary"-->
<!--        size="mini"-->
<!--        icon="el-icon-cloudy"-->
<!--        plain-->
<!--        @click="goTarget('https://gitcode.com/zzq20226705/greatPracticalTraining/overview')"-->
<!--      >è®¿é—® Code</el-button>-->
<!--      <el-button-->
<!--        size="mini"-->
<!--        icon="el-icon-s-home"-->
<!--        plain-->
<!--        @click="goTarget('https://gitcode.com/zzq20226705/')"-->
<!--      >è®¿é—®ä¸»é¡µ</el-button>-->
<!--    </p>-->

<!--  </div>-->
<!--</template>-->

<!--<script>-->
<!--export default {-->
<!--  name: "Index",-->
<!--  data() {-->
<!--    return {-->
<!--      version: "3.8.8",-->
<!--    };-->
<!--  },-->
<!--  methods: {-->
<!--    goTarget(href) {-->
<!--      window.open(href, "_blank");-->
<!--    },-->
<!--  },-->
<!--};-->
<!--</script>-->

<!--<style scoped lang="scss">-->
<!--.app-container {-->
<!--  padding: 20px;-->

<!--  h2 {-->
<!--    font-size: 26px;-->
<!--    font-weight: 400;-->
<!--    margin-top: 10px;-->
<!--  }-->

<!--  p {-->
<!--    margin-top: 10px;-->
<!--    font-size: 14px;-->
<!--  }-->

<!--  .project-details, .main-features, .tech-features, .contributing {-->
<!--    margin-top: 20px;-->
<!--    h3 {-->
<!--      font-size: 22px;-->
<!--      color: #333;-->
<!--      margin-bottom: 10px;-->
<!--    }-->
<!--    p, ol, ul {-->
<!--      font-size: 14px;-->
<!--      margin-left: 10px;-->
<!--    }-->
<!--  }-->
<!--}-->
<!--</style>-->
<template>
  <div class="app-container home">
    <div class="main-content">
      <!-- å·¦ä¾§å†…å®¹ -->
      <div class="left-panel">
        <el-col :sm="30" :lg="24" class="app-content">
        </el-col>
        <el-divider />
        <div align="center">
          <img alt="Logo" src="https://i.ibb.co/RC5jjDh/GitHub.png" width="20%" />
          <h1>è½¯ä»¶é€ ä»·é€š SoftcostEstimator</h1>
        </div>

        <p align="center">
          <img alt="release" src="https://img.shields.io/badge/release-v0.0.1-brightgreen" />
          <img alt="java" src="https://img.shields.io/badge/java-v23.0.1-brightgreen" />
          <img alt="state" src="https://img.shields.io/badge/state-å­µåŒ–-brightgreen" />
          <img alt="domain" src="https://img.shields.io/badge/domain-AI+è½¯ä»¶é€ ä»·è¯„ä¼°-brightgreen" />
          <img alt="PRs welcome" src="https://img.shields.io/badge/PRs-welcome-brightgreen" />
          <img alt="docs" src="https://img.shields.io/badge/docs-latest-blue" />
          <img alt="code style" src="https://img.shields.io/badge/code%20style-black-000000" />
        </p>

        <section class="project-details">
          <h3>ğŸ“˜ é¡¹ç›®ä»‹ç»</h3>
          <p>
            è¯¥é¡¹ç›®äº 11 æœˆ 12 æ—¥å¯åŠ¨ï¼Œæ—¨åœ¨æ„å»ºä¸€ä¸ªåŸºäºè‹¥ä¾åå°ç®¡ç†ç³»ç»Ÿçš„ AI+ è½¯ä»¶æˆæœ¬è¯„ä¼°ç³»ç»Ÿï¼šè½¯ä»¶é€ ä»·é€š SoftcostEstimatorï¼Œä¸“æ³¨äºç§Ÿæˆ·å’Œé¡¹ç›®ç®¡ç†ã€åŠŸèƒ½ç‚¹åˆ†æã€é€ ä»·ç»¼åˆè¯„ä¼°å’ŒæŠ¥å‘Šç”Ÿæˆä¸å±•ç¤ºå››ä¸ªå­ç³»ç»Ÿã€‚
          </p>
          <p>é¡¹ç›®åœ°å€ï¼š<a href="https://gitcode.com/zzq20226705/greatPracticalTraining.git" target="_blank">ä¼Ÿå¤§çš„å®è®­</a></p>
          <p>é¡¹ç›®æ–‡æ¡£ï¼š<a href="https://gitcode.com/zzq20226705/greatPracticalTraining/overview" target="_blank">é¡¹ç›®æ–‡æ¡£</a></p>
        </section>

        <section class="main-features">
          <h3>ğŸ”§ ä¸»è¦åŠŸèƒ½</h3>
          <ol>
            <li><b>ç§Ÿæˆ·å’Œé¡¹ç›®ç®¡ç†å­ç³»ç»Ÿï¼š</b> æ”¯æŒå¤šç§Ÿæˆ·ç¯å¢ƒï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§æ€§ï¼Œæå‡åä½œæ•ˆç‡ã€‚</li>
            <li><b>åŠŸèƒ½ç‚¹åˆ†æå­ç³»ç»Ÿï¼š</b> è¯„ä¼°å¸ˆå¯ä»¥å½•å…¥å’Œç®¡ç†è½¯ä»¶é¡¹ç›®çš„åŠŸèƒ½ç»“æ„ï¼Œæä¾›åŸºç¡€æ•°æ®ã€‚</li>
            <li><b>é€ ä»·ç»¼åˆè¯„ä¼°å­ç³»ç»Ÿï¼š</b> åŸºäºè¡Œä¸šåŸºå‡†æ•°æ®æˆ–å†å²é¡¹ç›®æ•°æ®ï¼Œæä¾›ç»¼åˆé€ ä»·è¯„ä¼°ã€‚</li>
            <li><b>æŠ¥å‘Šç”Ÿæˆä¸å±•ç¤ºå­ç³»ç»Ÿï¼š</b> æ”¯æŒç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼Œå¹¶é€šè¿‡æ•°æ®å¯è§†åŒ–å±•ç¤ºè¿›åº¦å’Œè¯„ä¼°ç»“æœã€‚</li>
          </ol>
        </section>

        <section class="tech-features">
          <h3>ğŸ›  æŠ€æœ¯ç‰¹ç‚¹</h3>
          <ul>
            <li><b>å‰åç«¯åˆ†ç¦»ï¼š</b> æé«˜å¼€å‘æ•ˆç‡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li>
            <li><b>AI+ï¼š</b> é›†æˆäººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œä¾¿äºæ‰©å±•ä¸ç»´æŠ¤ã€‚</li>
            <li><b>æ•°æ®äº‘ç«¯å­˜å‚¨ï¼š</b> æå‡æ•°æ®å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</li>
          </ul>
        </section>

        <section class="contributing">
          <h3>ğŸ¤ è´¡çŒ®æŒ‡å—</h3>
          <p>æ¬¢è¿è´¡çŒ®è€…æŒ‰ç…§ä»¥ä¸‹æ–¹å¼æäº¤è´¡çŒ®ã€‚</p>
          <ol>
            <li>Fork æœ¬ä»“åº“</li>
            <li>åˆ›å»ºç‰¹æ€§åˆ†æ”¯</li>
            <li>æäº¤æ›´æ”¹å¹¶æ¨é€åˆ°åˆ†æ”¯</li>
            <li>æäº¤ Pull Request</li>
          </ol>
        </section>
        <p>
          <el-button
            type="primary"
            size="mini"
            icon="el-icon-cloudy"
            plain
            @click="goTarget('https://gitcode.com/zzq20226705/greatPracticalTraining/overview')"
          >è®¿é—® Code</el-button>
          <el-button
            size="mini"
            icon="el-icon-s-home"
            plain
            @click="goTarget('https://gitcode.com/zzq20226705/')"
          >è®¿é—®ä¸»é¡µ</el-button>
        </p>
      </div>

      <!-- å³ä¾§èŠå¤©ç•Œé¢ -->
      <div class="chat-container">
        <!-- æ¶ˆæ¯å±•ç¤ºåŒºåŸŸ -->
        <div class="chat-box">
          <div
            v-for="message in messages"
            :key="message.id"
            class="message"
            :class="message.from === 'user' ? 'user-message' : 'ai-message'"
          >
            <p>{{ message.content }}</p>
          </div>
        </div>

        <!-- è¾“å…¥æ¡†ä¸å‘é€æŒ‰é’® -->
        <div class="input-container">
          <el-input
            v-model="userInput"
            placeholder="è¯·è¾“å…¥æ¶ˆæ¯..."
            clearable
            @keyup.enter.native="sendMessage"
            class="chat-input"
          />
          <el-button type="primary" icon="el-icon-send" @click="sendMessage" class="send-button">å‘é€</el-button>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { longPolling2, send2, createReport ,pollReport} from "@/api/evaluate/project";

export default {
  name: "Project",
  data() {
    return {
      messages: [], // æ¶ˆæ¯è®°å½•
      userInput: "ä½ å¥½", // ç”¨æˆ·è¾“å…¥
      pollingActive: false, // æ˜¯å¦æ­£åœ¨é•¿è½®è¯¢
      pollingActive2: false, // æ˜¯å¦æ­£åœ¨é•¿è½®è¯¢
      isEnd: false, // æ ‡è®°æ˜¯å¦ç»“æŸè½®è¯¢
      isEnd2: false, // æ ‡è®°æ˜¯å¦ç»“æŸè½®è¯¢
      currentAiMessageId: null, // å½“å‰æ­£åœ¨å›å¤çš„ AI æ¶ˆæ¯çš„ ID
      userMsgData: {}, // ç”¨æˆ·æ¶ˆæ¯æ•°æ®
      reportContent: "", // å­˜å‚¨æŠ¥å‘Šå†…å®¹
    };
  },
  async mounted() {
    this.sendMessage();
  },
  methods: {
    sendMessage() {
      if (!this.userInput.trim()) return;

      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      this.messages.push({
        id: Date.now(),
        content: this.userInput,
        from: "user",
      });

      this.userMsgData.content = this.userInput;
      send2(this.userMsgData);

      // æ¸…ç©ºè¾“å…¥æ¡†
      this.userInput = "";

      // æ·»åŠ  AI å›å¤å ä½
      const newAiMessage = {
        id: Date.now() + 1,
        content: "",
        from: "ai",
      };
      this.messages.push(newAiMessage);

      this.currentAiMessageId = newAiMessage.id;

      // å¯åŠ¨è½®è¯¢
      if (this.isEnd || !this.pollingActive) {
        this.isEnd = false;
        this.pollingActive = true;
        this.polling();
      }
    },
    async polling() {
      try {
        const response = await longPolling2();
        let newMessageContent = response.content.trim();

        const aiMessage = this.messages.find(
          (msg) => msg.id === this.currentAiMessageId
        );

        if (aiMessage) {
          aiMessage.content = `${aiMessage.content}${newMessageContent}`.trim();
        }

        if (response.end) {
          this.isEnd = true;
          this.pollingActive = false;
        } else if (this.pollingActive) {
          this.polling();
        }
      } catch (error) {
        console.error("é•¿è½®è¯¢å¤±è´¥:", error);
        if (this.pollingActive) {
          setTimeout(this.polling, 5000);
        }
      }
    },
    async polling2() {
      try {
        const response = await pollReport2();

        // å°†æ•°æ®è¿½åŠ åˆ° reportContent
        this.reportContent += response.content; // å‡è®¾ response.data æ˜¯å­—ç¬¦ä¸²

        if (response.end) {
          this.isEnd2 = true;
          this.pollingActive2 = false;
        } else if (this.pollingActive2) {
          this.polling2();
        }
      } catch (error) {
        console.error("é•¿è½®è¯¢å¤±è´¥:", error);
        if (this.pollingActive2) {
          setTimeout(this.polling, 5000);
        }
      }
    }
  },
};
</script>
<style scoped lang="scss">
.app-container {
  display: flex;
  flex-direction: column;
  padding: 20px;

  .main-content {
    display: flex;
    flex-direction: row;
    height: calc(100vh - 40px);

    .left-panel {
      flex: 2;
      padding: 20px;
      overflow-y: auto;
    }

    .chat-container {
      flex: 3;
      display: flex;
      flex-direction: column;
      border-left: 1px solid #ddd;
      padding: 20px;
      overflow-y: auto;

      .chat-box {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 20px;

        .message {
          margin: 10px 0;

          &.user-message {
            text-align: right;
            color: #409eff;
          }

          &.ai-message {
            text-align: left;
            color: #666;
          }
        }
      }

      .input-container {
        display: flex;

        .chat-input {
          flex: 1;
          margin-right: 10px;
        }

        .send-button {
          width: 100px;
        }
      }
    }
  }
}
</style>
